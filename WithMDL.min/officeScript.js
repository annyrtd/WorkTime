function mergeSort(t,e){var o=t.length,n=Math.floor(o/2);return e||(e=function(t,e){return e>t?-1:t==e?0:1}),2>o?t:merge(mergeSort(t.slice(0,n),e),mergeSort(t.slice(n,o),e),e)}function merge(t,e,o){for(var n=[];t.length>0||e.length>0;)t.length>0&&e.length>0?o(t[0],e[0])<=0?(n.push(t[0]),t=t.slice(1)):(n.push(e[0]),e=e.slice(1)):t.length>0?(n.push(t[0]),t=t.slice(1)):e.length>0&&(n.push(e[0]),e=e.slice(1));return n}function CreateSearchInput(){var t=$("<input>",{type:"text",id:"searchInput",title:"Введите фамилию или имя сотрудника",placeholder:"Сотрудник"}).css("width","100px");$("th.text").eq(0).children().hide(),$("th.text").eq(0).append(t)}function CreateSearchInput_withMD(){var t=$("<input>",{type:"text","class":"mdl-textfield__input",id:"searchInput",title:"Введите фамилию или имя сотрудника"}),e=$("<label></label>",{"class":"mdl-textfield__label","for":"searchInput",style:"line-height: 12pt !important;"}).append("Сотрудник"),o=$('<i class="material-icons" style="float: left; margin-top: 22px;">search</i>'),n=$("<div></div>",{"class":"mdl-textfield mdl-js-textfield"}).append(t,e);$("th.text").eq(0).children().hide(),$("th.text").eq(0).append(o,n),componentHandler.upgradeElement($(".mdl-textfield.mdl-js-textfield").get(0))}function escapeHtml(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,function(t){return e[t]})}function SetClassesOnColumns(){$("th.text").first().addClass("employee header"),$("col.text").first().addClass("employee"),$("tbody tr").each(function(t){$(this).children("td.text").first().addClass("employee")}),$("th.text").eq(1).addClass("info"),$("col.text").eq(1).addClass("info"),$("tbody tr").each(function(t){$(this).children("td.text").eq(1).addClass("info")}),$("th.text.phone").first().addClass("first"),$("col.text.phone").first().addClass("first"),$("tbody tr").each(function(t){$(this).children("td.text.phone").first().addClass("first")}),$("th.text.phone").eq(1).addClass("second"),$("col.text.phone").eq(1).addClass("second"),$("tbody tr").each(function(t){$(this).children("td.text.phone").eq(1).addClass("second")}),$("th.text.phone").eq(2).addClass("third"),$("col.text.phone").eq(2).addClass("third"),$("tbody tr").each(function(t){$(this).children("td.text.phone").eq(2).addClass("third")}),$("th.text").eq(5).addClass("workgroup header"),$("col.text").eq(5).addClass("workgroup"),$("tbody tr").each(function(t){$(this).children("td.text").eq(5).addClass("workgroup")}),$("th.text").eq(6).addClass("room header"),$("col.text").eq(6).addClass("room"),$("tbody tr").each(function(t){$(this).children("td.text").eq(6).addClass("room")}),$("th.indicator").first().addClass("workstate header"),$("col.indicator").first().addClass("workstate"),$("tbody tr").each(function(t){$(this).children("td.indicator").first().addClass("workstate")}),$("th.indicator").last().addClass("mail"),$("col.indicator").last().addClass("mail"),$("tbody tr").each(function(t){$(this).children("td.indicator").last().addClass("mail")})}function CreateSelectForGroups(){var t=[];$("table.full-size > tbody > tr").each(function(e){var o=$(this).children("td.workgroup").text();t.indexOf(o)<0&&t.push(o)}),t.sort();var e,o;IsMyHomeOffice()&&(e=$('<button style="float: left;" id="groupSelectButton" class="mdl-button mdl-js-button mdl-button--icon  mdl-button--accent mdl-js-ripple-effect"><i class="material-icons">home</i></button>'),o=$('<div class="mdl-tooltip" for="groupSelectButton">Моя группа</div>'));for(var n=$("<select></select>",{id:"workgroupSelect",title:"Выберите группу"}).append("<option value=''>Группы</option>"),r=0;r<t.length;r++)""!=t[r]?n.append("<option value='"+t[r]+"'>"+t[r]+"</option>"):n.append("<option value='NoGroup'>---</option>");$("th.text").eq(5).children().hide(),void 0!==e&&void 0!==o?($("th.text").eq(5).append(e,o,n),componentHandler.upgradeElement(e.get(0)),componentHandler.upgradeElement(o.get(0))):$("th.text").eq(5).append(n)}function CreateSelectOnWorkState(){var t=$("<select></select>",{id:"workStateSelect",title:"Выберите состояние"}).append("<option value='' title='Выберите состояние'></option>").append("<option id='option_ball_green' value='/Content/ball_green.png' title='На работе'>На работе</option>").append("<option id='option_ball_blue' value='/Content/ball_blue.png' title='Работает удаленно'>Работает удаленно</option>").append("<option id='option_ball_yellow' value='/Content/ball_yellow.png' title='Закончил работу'>Закончил работу</option>").append("<option id='option_ball_gray' value='/Content/ball_gray.png' title='Отсутствует'>Отсутствует</option>");$("th.indicator").eq(0).append(t)}function CreateSelectOnRoom(){var t=[];$("table.full-size > tbody > tr").each(function(e){var o=$(this).children("td.room").text();t.indexOf(o)<0&&t.push(o)}),t.sort();var e,o;IsMyHomeOffice()&&(e=$('<button style="float: left;" id="roomSelectButton" class="mdl-button mdl-js-button mdl-button--icon  mdl-button--accent mdl-js-ripple-effect"><i class="material-icons">home</i></button>'),o=$('<div class="mdl-tooltip" for="roomSelectButton">Моя комната</div>'));for(var n=$("<select></select>",{id:"roomSelect",title:"Выберите номер комнаты"}).append("<option value=''>Комната</option>"),r=0;r<t.length;r++)""!=t[r]?n.append("<option value='"+t[r]+"'>"+t[r]+"</option>"):n.append("<option value='NoRoom'>---</option>");$("th.text").eq(6).children().hide(),void 0!==e&&void 0!==o?($("th.text").eq(6).append(e,o,n),componentHandler.upgradeElement(e.get(0)),componentHandler.upgradeElement(o.get(0))):$("th.text").eq(6).append(n)}function IsMyHomeOffice(){var t=GetMyName();return $('td.employee:contains("'+t+'")').length>0?!0:!1}function PrepareEmployeeColumnForSort(){var t=$("<div></div>",{"class":"arrowDiv"}).css({"float":"right",margin:"20px 0px",backgroundImage:"url("+chrome.extension.getURL("/images/bg.gif")+")"}),e=$("<div></div>",{"class":"clearfix"});$("#searchInput").css("float","left"),$("#searchInput").parent().after(t,e)}function PrepareWorkgroupColumnForSort(){var t=$("<div></div>",{"class":"arrowDiv"}).css("float","right").css("backgroundImage","url("+chrome.extension.getURL("/images/bg.gif")+")"),e=$("<div></div>",{"class":"clearfix"});$("#workgroupSelect").css("float","left"),$("#workgroupSelect").after(t,e)}function PrepareRoomColumnForSort(){var t=$("<div></div>",{"class":"arrowDiv"}).css("float","right").css("backgroundImage","url("+chrome.extension.getURL("/images/bg.gif")+")"),e=$("<div></div>",{"class":"clearfix"});$("#roomSelect").css("float","left"),$("#roomSelect").after(t,e)}function RemoveEmptyColumns(){$("table.full-size > thead th").each(function(t){var e=!0;$("table.full-size > tbody > tr").each(function(o){""!=$(this).children("td").eq(t).html()&&(e=!1)}),e&&($(this).hide(),$("table.full-size > tbody > tr").each(function(e){$(this).children("td").eq(t).hide()}))})}function GetColumnToSort(t){return $(t).hasClass("employee")?"employee":$(t).hasClass("workgroup")?"workgroup":$(t).hasClass("room")?"room":void 0}function AddResetFiltersButton(){var t=$('<i class="material-icons">clear</i>'),e=$("<button></button>",{id:"idReset","class":"mdl-button mdl-js-button  mdl-button--fab mdl-button--icon mdl-button--accent  mdl-js-ripple-effect",type:"button"}).append(t),o=$("<div></div>",{"class":"buttonDiv"}).append(e).css("width","100%");$("table.full-size colgroup").append('<col class="reset button">'),$("table.full-size thead tr").append('<th class="reset button"></th>'),$("th.reset.button").append(o),$("table.full-size tbody tr").each(function(){$(this).append('<td class="reset button"></td>')});var n=$('<div class="mdl-tooltip" for="idReset">Сбросить<br>фильтры</div>');componentHandler.upgradeElement(n.get(0)),componentHandler.upgradeElement(e.get(0)),$("th.reset.button").append(n),$("button#idReset").hide()}function SetFilters(){$("table.full-size > tbody > tr").show(),$("#searchInput").val(""),FilterGroup(),FilterWorkState(),FilterRoom()}function FilterGroup(){var t=$("select#workgroupSelect option").filter(":selected").val();if(""!=t){if("NoGroup"==t)return void $("td.workgroup").not("[style='display: none;']").each(function(t){""==$(this).text()?$(this).parent().show():$(this).parent().hide()});var e='td.workgroup:contains("'+t+'")';$(e).parent().not("[style='display: none;']").show(),$("td.workgroup").not(e).parent().hide()}}function FilterWorkState(){var t=$("select#workStateSelect option").filter(":selected").val();if(""==t)return $("select#workStateSelect").attr("title","Выберите состояние"),void $("th.workstate i").css("color","white").attr("title","Выберите состояние").css("textShadow","-1px 0 gray, 0 1px gray, 1px 0 gray, 0 -1px gray");$("tbody tr").not('[style="display: none;"]').each(function(e){$(this).children("td.indicator").first().children("img").attr("src").indexOf(t)>-1?$(this).show():$(this).hide()});var e=$("select#workStateSelect option").filter(":selected").attr("title"),o=$("select#workStateSelect option").filter(":selected").attr("id").replace("option_ball_","");switch(o){case"green":o="#8bc349";break;case"blue":o="rgb(63, 81, 181)";break;case"yellow":o="#ffeb3b"}$("select#workStateSelect").attr("title",e),$("th.workstate i").css("color",o).attr("title",e).css("textShadow","none")}function FilterRoom(){var t=$("select#roomSelect option").filter(":selected").val();if(""!=t){if("NoRoom"==t)return void $("td.room").not('[style="display: none;"]').each(function(t){""==$(this).text()?$(this).parent().show():$(this).parent().hide()});var e='td.room:contains("'+t+'")';$(e).parent().not('[style="display: none;"]').show(),$("td.room").not(e).parent().hide()}}function SelectHomeGroup(){$("table.full-size > tbody > tr").show(),$("#searchInput").val("");var t=GetMyGroupName();if($("#workgroupSelect").val(t),""!=t){if("NoGroup"==t)return void $("td.workgroup").not('[style="display: none;"]').each(function(t){""==$(this).text()?$(this).parent().show():$(this).parent().hide()});var e='td.workgroup:contains("'+t+'")';$(e).parent().not('[style="display: none;"]').show(),$("td.workgroup").not(e).parent().hide()}}function GetMyGroupName(){var t="",e=GetMyName();return $("td.workgroup").each(function(o){return $(this).parent().children("td.employee").text()==e?(t=$(this).text(),!1):void 0}),t}function GetMyName(){var t=$(".status-right a").text(),e=t.indexOf(" "),o=t.substr(0,e),n=t.substr(e+1);return t=n+" "+o}function SelectHomeRoom(){$("table.full-size > tbody > tr").show(),$("#searchInput").val("");var t=GetMyRoomNumber();if($("#roomSelect").val(t),""!=t){if("NoRoom"==t)return void $("td.room").not('[style="display: none;"]').each(function(t){""==$(this).text()?$(this).parent().show():$(this).parent().hide()});var e='td.room:contains("'+t+'")';$(e).parent().not('[style="display: none;"]').show(),$("td.room").not(e).parent().hide()}}function GetMyRoomNumber(){var t="",e=GetMyName();return $("td.room").each(function(o){return $(this).parent().children("td.employee").text()==e?(t=$(this).text(),!1):void 0}),t}function CreateMDLCard(){$(".status-center").hide(),$(".main").hide();var t=$("<span></span>",{"class":"mdl-layout-title"}).append($(".status-center").text());$("table.full-size").addClass("mdl-shadow--2dp"),$(".mdl-layout__content").append(t,$("table.full-size"))}function ResizeTableHeader(){var t,e=$("table.full-size"),o=e.find("tbody tr").not("[style='display: none;']").first().children();t=o.map(function(){return $(this).width()}).get(),e.find("th").each(function(e,o){$(o).width(t[e])})}function CreateSettingsForLang(){$("div.mdl-layout__drawer").append($("<div id=settings></div>")),$("#settings").load("http://co-msk-app02/Preferences/Edit form",function(){$("#settings").hide(),$("#settings").prepend("<br><label><b>Настройки:</b></label><br><br>"),$("#ReturnTo").val("/"+window.location.search),$("#settings a").hide(),$("#settings label").removeAttr("for"),$("#settings label").after("<br>"),$("div.table-form").last().next().css({paddingTop:"2em"}),$("div.table-form").hide(),$("div.table-form").first().show(),ReplaceInput.apply($("form[action='/Preferences/Edit'] input[type=submit]").get(0)),ChangeButtonsToMD.apply($("form[action='/Preferences/Edit'] button.inputReplaceButton").get(0)),$("form[action='/Preferences/Edit'] button.inputReplaceButton").parent().css("width","0px"),$("#settings").fadeIn("fast")})}function SetTableHeightForOffice(){$("table.full-size tbody").height($(window).height()-370)}function CheckResetButton(){""!=$("#workgroupSelect").val()||""!=$("#workStateSelect").val()||""!=$("#roomSelect").val()||""!=$("#searchInput").val()?$("button#idReset").fadeIn("fast"):$("button#idReset").fadeOut("fast")}function AddBorderToStatusSelect(){var t=$("<span></span>").css({display:"block",border:"1px solid rgb(202, 202, 202)",paddingLeft:"3px"}).append($("th.indicator.workstate.header").children());$("th.indicator.workstate.header").append(t)}jQuery.expr[":"].contains=function(t,e,o){return jQuery(t).text().toUpperCase().indexOf(o[3].toUpperCase())>=0},$(document).ready(function(){CreateSearchInput_withMD(),SetClassesOnColumns(),CreateSelectForGroups(),CreateSelectOnWorkState(),CreateSelectOnRoom(),PrepareEmployeeColumnForSort(),PrepareWorkgroupColumnForSort(),PrepareRoomColumnForSort(),RemoveEmptyColumns(),AddResetFiltersButton(),CreateSettingsForLang(),CreateMDLCard(),AddBorderToStatusSelect(),$("button").not("#idReset").not(".mdl-button--icon").not("form[action='/Remote/Come'] button, form[action='/Remote/Leave'] button").each(function(t){ChangeButtonsToMD.apply(this)}),$("table.full-size").before($("div.holiday-box")),ShowTableFullSizeAndHolidayBox(),ResizeTableHeader(),$("#searchInput").on("propertychange input change keyup paste click",function(){$("#workgroupSelect, #workStateSelect, #roomSelect").val("");var t=escapeHtml($(this).val()),e='td.employee:contains("'+t+'")',o='td.employee:contains("'+t+'")';$(e).parent().show(),$("td.employee").not(o).parent().hide(),$("th.workstate i").css("color","white").attr("title","Выберите состояние").css("textShadow","-1px 0 gray, 0 1px gray, 1px 0 gray, 0 -1px gray"),$("select#workStateSelect").attr("title","Выберите состояние"),ResizeTableHeader(),CheckResetButton()}),$("#workgroupSelect, #workStateSelect, #roomSelect").change(function(){SetFilters(),ResizeTableHeader(),CheckResetButton()}),$(".arrowDiv").click(function(){var t=GetColumnToSort($(this).parent()),e=$("table.full-size > tbody > tr");$(this).hasClass("headerSortUp")?(e=mergeSort(e,function(e,o){return $(e).children("td."+t).text().toLowerCase()>$(o).children("td."+t).text().toLowerCase()?-1:$(e).children("td."+t).text().toLowerCase()<$(o).children("td."+t).text().toLowerCase()?1:0}),$(this).removeClass("headerSortUp").addClass("headerSortDown").css("backgroundImage","url("+chrome.extension.getURL("/images/asc.gif")+")")):(e=mergeSort(e,function(e,o){return $(e).children("td."+t).text()>$(o).children("td."+t).text()?1:$(e).children("td."+t).text()<$(o).children("td."+t).text()?-1:0}),$(this).removeClass("headerSortDown").addClass("headerSortUp").css("backgroundImage","url("+chrome.extension.getURL("/images/desc.gif")+")")),$("table.full-size > tbody").append(e)}),$("button#idReset").on("click",function(){$("table.full-size > tbody > tr").show(),$("#workgroupSelect, #workStateSelect, #roomSelect").val(""),$("#searchInput").val("").parent().removeClass("is-dirty"),$("th.workstate i").css("color","white").attr("title","Выберите состояние").css("textShadow","-1px 0 gray, 0 1px gray, 1px 0 gray, 0 -1px gray"),$("select#workStateSelect").attr("title","Выберите состояние"),ResizeTableHeader(),$(this).fadeOut("fast")}),$("#roomSelectButton").click(function(){SelectHomeRoom(),ResizeTableHeader(),CheckResetButton()}),$("#groupSelectButton").click(function(){SelectHomeGroup(),ResizeTableHeader(),CheckResetButton()}),$(window).resize(function(){ResizeTableHeader(),SetTableHeightForOffice()}).resize()});