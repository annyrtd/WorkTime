jQuery.expr[":"].contains=function(c,d,b){return jQuery(c).text().toUpperCase().indexOf(b[3].toUpperCase())>=0};function mergeSort(d,c){var b=d.length,a=Math.floor(b/2);if(!c){c=function(f,e){if(f<e){return -1}if(f==e){return 0}else{return 1}}}if(b<2){return d}return merge(mergeSort(d.slice(0,a),c),mergeSort(d.slice(a,b),c),c)}function merge(d,b,c){var a=[];while(d.length>0||b.length>0){if(d.length>0&&b.length>0){if(c(d[0],b[0])<=0){a.push(d[0]);d=d.slice(1)}else{a.push(b[0]);b=b.slice(1)}}else{if(d.length>0){a.push(d[0]);d=d.slice(1)}else{if(b.length>0){a.push(b[0]);b=b.slice(1)}}}}return a}function CreateSearchInput_withMD(){var a=$("<input>",{type:"text","class":"mdl-textfield__input",id:"searchInput"});var c=$("<label></label>",{"class":"mdl-textfield__label","for":"searchInput",style:"line-height: 12pt !important;"}).append("Сотрудник");var b=$('<i class="material-icons" style="float: left; margin-top: 22px;">search</i>');var d=$("<div></div>",{"class":"mdl-textfield mdl-js-textfield"}).append(a,c);$("th.text").eq(0).children().hide();$("th.text").eq(0).append(b,d);componentHandler.upgradeElement($(".mdl-textfield.mdl-js-textfield").get(0));ChangeTitleToMDTooltip("searchInput","Введите фамилию <br>или имя сотрудника")}function escapeHtml(b){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return b.replace(/[&<>"']/g,function(c){return a[c]})}function SetClassesOnColumns(){var a=" header";$("th.text").first().addClass("employee header");$("col.text").first().addClass("employee");$("tbody tr").each(function(b){$(this).children("td.text").first().addClass("employee")});$("th.text").eq(1).addClass("info");$("col.text").eq(1).addClass("info");$("tbody tr").each(function(b){$(this).children("td.text").eq(1).addClass("info")});$("th.text.phone").first().addClass("first");$("col.text.phone").first().addClass("first");$("tbody tr").each(function(b){$(this).children("td.text.phone").first().addClass("first")});$("th.text.phone").eq(1).addClass("second");$("col.text.phone").eq(1).addClass("second");$("tbody tr").each(function(b){$(this).children("td.text.phone").eq(1).addClass("second")});$("th.text.phone").eq(2).addClass("third");$("col.text.phone").eq(2).addClass("third");$("tbody tr").each(function(b){$(this).children("td.text.phone").eq(2).addClass("third")});$("th.text").eq(5).addClass("workgroup header");$("col.text").eq(5).addClass("workgroup");$("tbody tr").each(function(b){$(this).children("td.text").eq(5).addClass("workgroup")});$("th.text").eq(6).addClass("room header");$("col.text").eq(6).addClass("room");$("tbody tr").each(function(b){$(this).children("td.text").eq(6).addClass("room")});$("th.indicator").first().addClass("workstate header");$("col.indicator").first().addClass("workstate");$("tbody tr").each(function(b){$(this).children("td.indicator").first().addClass("workstate")});$("th.indicator").last().addClass("mail");$("col.indicator").last().addClass("mail");$("tbody tr").each(function(b){$(this).children("td.indicator").last().addClass("mail")})}function CreateSelectForGroups(){var b=GetGroupNames();var d,e;if(IsMyHomeOffice()){d=$('<button style="float: left;" id="groupSelectButton" class="mdl-button mdl-js-button mdl-button--icon  mdl-button--accent mdl-js-ripple-effect"><i class="material-icons">group</i></button>');e=$('<div class="mdl-tooltip" for="groupSelectButton">Моя группа</div>')}var a=$("<select></select>",{id:"workgroupSelect",title:"Выберите группу"}).append("<option value=''>Группа</option>");for(var c=0;c<b.length;c++){if(b[c]!=""){a.append("<option value='"+b[c]+"'>"+b[c]+"</option>")}else{a.append("<option value='NoGroup'>---</option>")}}$("th.text").eq(5).children().hide();if(d!==undefined&&e!==undefined){$("th.text").eq(5).append(d,e,a);componentHandler.upgradeElement(d.get(0));componentHandler.upgradeElement(e.get(0))}else{$("th.text").eq(5).append(a)}}function GetGroupNames(){var a=[];$("table.full-size > tbody > tr").each(function(b){var c=$(this).children("td.workgroup").text();if(a.indexOf(c)<0){a.push(c)}});a.sort();return a}function CreateSelectOnWorkState(){var a=$("<select></select>",{id:"workStateSelect",title:"Выберите состояние"}).append("<option value=''></option>").append("<option id='option_ball_green' value='/Content/ball_green.png'>На работе</option>").append("<option id='option_ball_blue' value='/Content/ball_blue.png'>Работает удаленно</option>").append("<option id='option_ball_yellow' value='/Content/ball_yellow.png'>Закончил работу</option>").append("<option id='option_ball_gray' value='/Content/ball_gray.png'>Отсутствует</option>");$("th.indicator").eq(0).append(a)}function CreateSelectOnRoom(){var e=GetRoomNumbers();var c,d;if(IsMyHomeOffice()){c=$('<button style="float: left;" id="roomSelectButton" class="mdl-button mdl-js-button mdl-button--icon  mdl-button--accent mdl-js-ripple-effect"><i class="material-icons">weekend</i></button>');d=$('<div class="mdl-tooltip" for="roomSelectButton">Моя комната</div>')}var a=$("<select></select>",{id:"roomSelect",title:"Выберите номер комнаты"}).append("<option value=''>Комната</option>");for(var b=0;b<e.length;b++){if(e[b]!=""){a.append("<option value='"+e[b]+"'>"+e[b]+"</option>")}else{a.append("<option value='NoRoom'>---</option>")}}$("th.text").eq(6).children().hide();if(c!==undefined&&d!==undefined){$("th.text").eq(6).append(c,d,a);componentHandler.upgradeElement(c.get(0));componentHandler.upgradeElement(d.get(0))}else{$("th.text").eq(6).append(a)}}function GetRoomNumbers(){var a=[];$("table.full-size > tbody > tr").each(function(b){var c=$(this).children("td.room").text();if(a.indexOf(c)<0){a.push(c)}});a.sort();return a}function IsMyHomeOffice(){var a=GetMyName();if($('td.employee:contains("'+a+'")').length>0){return true}return false}function CreateSelectOnGender(){var a=$("<select></select>",{id:"genderSelect",title:"Выберите пол"}).append("<option value=''>Все</option>").append("<option value='man'>Мужчины</option>").append("<option value='woman'>Женщины</option>");$("th.text.info").first().append(a)}function PrepareEmployeeColumnForSort(){var b=$("<div></div>",{"class":"arrowDiv"}).css({"float":"right",margin:"20px 0px",backgroundImage:"url("+chrome.extension.getURL("/images/bg.gif")+")"});var a=$("<div></div>",{"class":"clearfix"});$("#searchInput").css("float","left");$("#searchInput").parent().after(b,a)}function PrepareWorkgroupColumnForSort(){var b=$("<div></div>",{"class":"arrowDiv"}).css("float","right").css("backgroundImage","url("+chrome.extension.getURL("/images/bg.gif")+")");var a=$("<div></div>",{"class":"clearfix"});$("#workgroupSelect").css("float","left");$("#workgroupSelect").after(b,a)}function PrepareRoomColumnForSort(){var b=$("<div></div>",{"class":"arrowDiv"}).css("float","right").css("backgroundImage","url("+chrome.extension.getURL("/images/bg.gif")+")");var a=$("<div></div>",{"class":"clearfix"});$("#roomSelect").css("float","left");$("#roomSelect").after(b,a)}function RemoveEmptyColumns(){$("table.full-size > thead th").each(function(a){var b=true;$("table.full-size > tbody > tr").each(function(c){if($(this).children("td").eq(a).html()!=""){b=false}});if(b){$(this).hide();$("table.full-size > tbody > tr").each(function(c){$(this).children("td").eq(a).hide()})}})}function GetColumnToSort(a){if($(a).hasClass("employee")){return"employee"}if($(a).hasClass("workgroup")){return"workgroup"}if($(a).hasClass("room")){return"room"}}function AddResetFiltersButton(){var b=$('<i class="material-icons">clear</i>');var a=$("<button></button>",{id:"idReset","class":"mdl-button mdl-js-button  mdl-button--fab mdl-button--icon mdl-button--accent  mdl-js-ripple-effect",type:"button"}).append(b);var d=$("<div></div>",{"class":"buttonDiv"}).append(a).css("width","100%");$("table.full-size colgroup").append('<col class="reset button">');$("table.full-size thead tr").append('<th class="reset button"></th>');$("th.reset.button").append(d);$("table.full-size tbody tr").each(function(){$(this).append('<td class="reset button"></td>')});var c=$('<div class="mdl-tooltip" for="idReset">Сбросить<br>фильтры</div>');componentHandler.upgradeElement(c.get(0));componentHandler.upgradeElement(a.get(0));$("th.reset.button").append(c);$("button#idReset").hide()}function SetFilters(){$("table.full-size > tbody > tr").show();$("div.card-square").show();$("#searchInput").val("");$("#card-searchInput").val("");a();d();b();c();function a(){var f=$("select#workgroupSelect option").filter(":selected").val();if(f==""){return}if(f=="NoGroup"){$("td.workgroup").not('[style~="display: none;"]');each(function(g){if($(this).text()!=""){$(this).parent().hide()}});$(".card-square").not('[style~="display: none;"]').each(function(){var g=$(this).find("span.workgroup").first();if(g){$(this).hide()}});return}var e='td.workgroup:contains("'+f+'")';$("td.workgroup").not(e).parent().hide();$(".card-square").not('[style~="display: none;"]').each(function(){if($(this).find("span.workgroup").first().text()!=f){$(this).hide()}})}function d(){var f=$("select#workStateSelect option").filter(":selected").val();if(f==""){$("select#workStateSelect").attr("title","Выберите состояние");$("th.workstate i").css("color","white").attr("title","Выберите состояние").css("textShadow","-1px 0 gray, 0 1px gray, 1px 0 gray, 0 -1px gray");return}$("tbody tr").not('[style~="display: none;"]').each(function(h){if($(this).children("td.indicator").first().children("img").attr("src").indexOf(f)<=-1){$(this).hide()}});$(".card-square").not('[style~="display: none;"]').each(function(h){if($(this).find(".circular").attr("datavalue").indexOf(f)<=-1){$(this).hide()}});var g=$("select#workStateSelect option").filter(":selected").attr("title");var e=$("select#workStateSelect option").filter(":selected").attr("id").replace("option_ball_","");switch(e){case"green":e="#8bc349";break;case"blue":e="rgb(63, 81, 181)";break;case"yellow":e="#ffeb3b";break}$("select#workStateSelect").attr("title",g);$("th.workstate i").css("color",e).attr("title",g).css("textShadow","none")}function b(){var f=$("select#roomSelect option").filter(":selected").val();if(f==""){return}if(f=="NoRoom"){$("td.room").not('[style~="display: none;"]').each(function(g){if($(this).text()!=""){$(this).parent().hide()}});$(".card-square").not('[style~="display: none;"]').each(function(){var g=$(this).find("span.room").first();if(g){$(this).hide()}});return}var e='td.room:contains("'+f+'")';$("td.room").not(e).parent().hide();$(".card-square").not('[style~="display: none;"]').each(function(){if($(this).find("span.room").first().text()!=f){$(this).hide()}})}function c(){var e=$("select#genderSelect option").filter(":selected").val();if(e==""){return}$("table.full-size tbody tr").not('[style~="display: none;"]').each(function(){var g=$(this).find("td.employee").text();var f=$(".card-square:contains("+g+")").first();if(f.find("."+e).length<=0){$(this).hide();f.hide()}})}}function SelectHomeGroup(){$("table.full-size > tbody > tr").show();$("div.card-square").show();$("#searchInput").val("");$("#card-searchInput").val("");var c=a();$("#workgroupSelect").val(c);$("#groupMenuSpan").text(c);if(c==""){return}if(c=="NoGroup"){$("td.workgroup").not('[style~="display: none;"]').each(function(d){if($(this).text()!=""){$(this).parent().hide()}});return}var b='td.workgroup:contains("'+c+'")';$("td.workgroup").not(b).parent().hide();$(".card-square").not('[style~="display: none;"]').each(function(){if($(this).find("span.workgroup").first().text()!=c){$(this).hide()}});function a(){var d="";var e=GetMyName();$("td.workgroup").each(function(f){if($(this).parent().children("td.employee").text()==e){d=$(this).text();return false}});return d}}function GetMyName(){var c=$(".status-right a").text();var a=c.indexOf(" ");var d=c.substr(0,a);var b=c.substr(a+1);c=b+" "+d;return c}function SelectHomeRoom(){$("table.full-size > tbody > tr").show();$("div.card-square").show();$("#searchInput").val("");$("#card-searchInput").val("");var c=a();$("#roomSelect").val(c);$("#roomMenuSpan").text(c);if(c==""){return}if(c=="NoRoom"){$("td.room").not('[style~="display: none;"]').each(function(d){if($(this).text()!=""){$(this).parent().hide()}});return}var b='td.room:contains("'+c+'")';$("td.room").not(b).parent().hide();$(".card-square").not('[style~="display: none;"]').each(function(){if($(this).find("span.room").first().text()!=c){$(this).hide()}});function a(){var d="";var e=GetMyName();$("td.room").each(function(f){if($(this).parent().children("td.employee").text()==e){d=$(this).text();return false}});return d}}function CreateMDLCard(){$(".status-center").hide();$(".main").hide();var a=$("<span></span>",{"class":"mdl-layout-title"}).append($(".status-center").text());$("table.full-size").addClass("mdl-shadow--2dp");$(".mdl-layout__content").append(a,$("table.full-size"))}function ResizeTableHeader(){var a=$("table.full-size"),c=a.find("tbody tr").not('[style~="display: none;"]').first().children(),b;b=c.map(function(){return $(this).width()}).get();a.find("th").each(function(e,d){$(d).width(b[e])})}function CreateSettingsForLangAndDisplay(){$("div.mdl-layout__drawer").append($("<div id=settings></div>"));$("#settings").load("http://co-msk-app02/Preferences/Edit form",function(){$("#settings").hide();$("#settings").prepend("<br><br><label><b>Настройки:</b></label>");$("#ReturnTo").val("/"+window.location.search);$("#settings a").hide();$("#settings label").removeAttr("for");$("#settings label").after("<br>");$("div.table-form").last().next().css({paddingTop:"2em"});$("div.table-form").hide();$("div.table-form").first().show();$("div.table-form").eq(4).show();$("div.table-form").eq(4).children("label").text("Вид по умолчанию:");$("select#SummaryWithoutToday option[value=No]").text("Таблица");$("select#SummaryWithoutToday option[value=Yes]").text("Карточки");var a;if($("head title").first().text().toLowerCase().indexOf("ярославль")>-1){a="isRussianEquivalentSet_Yar";if($("#ListLanguage").children("option:selected").val()=="English"){if(localStorage[a]){SetGenderForEnglishLanguage()}else{$(".genderMenu").remove();$(".rowDiv i.man").parent().remove();$(".rowDiv i.woman").parent().remove()}}else{SetRussianEquivalentForEnglishNames(a)}}else{a="isRussianEquivalentSet_Msk";if($("#ListLanguage").children("option:selected").val()=="English"){if(localStorage[a]){SetGenderForEnglishLanguage()}else{$(".genderMenu").remove();$(".rowDiv i.man").parent().remove();$(".rowDiv i.woman").parent().remove()}}else{SetRussianEquivalentForEnglishNames(a)}}ChangeTableCardMode();ReplaceInput.apply($("form[action='/Preferences/Edit'] input[type=submit]").get(0));ChangeButtonsToMD.apply($("form[action='/Preferences/Edit'] button.inputReplaceButton").get(0));$("form[action='/Preferences/Edit'] button.inputReplaceButton").parent().css("width","0px");$("#settings").fadeIn("fast")})}function SetTableHeightForOffice(){var b=$("table.full-size tbody");var a=$(window).height()-$("header.mdl-layout__header").outerHeight(true)-$("main.mdl-layout__content.content-wide span.mdl-layout-title").outerHeight(true)-$("table.full-size thead").outerHeight(true)-$(".holiday-box").outerHeight(true)-50;b.height(a);if(b.get(0).scrollHeight<=b.get(0).clientHeight){b.css("height","auto")}}function CheckResetButton(){if($("#workgroupSelect").val()!=""||$("#workStateSelect").val()!=""||$("#roomSelect").val()!=""||$("#genderSelect").val()!=""||$("#searchInput").val()!=""||$("#card-man").hasClass("checked")||$("#card-woman").hasClass("checked")||$("#card-searchInput").val()!=""){$("button#idReset").fadeIn("fast");$("button#card-idReset").fadeIn("fast")}else{$("button#idReset").fadeOut("fast");$("button#card-idReset").fadeOut("fast")}}function AddBorderToStatusSelect(){var a=$("<span></span>").css({display:"block",border:"1px solid rgb(202, 202, 202)",paddingLeft:"3px",borderRadius:"2px"}).append($("th.indicator.workstate.header").children());$("th.indicator.workstate.header").append(a)}function AddTooltips_officeScript(){$("tbody i:contains('email')").each(function(a){if($(this).attr("title")===undefined){return true}var c="i_email_"+a;var b=$(this).attr("title");$(this).removeAttr("title");$(this).attr("id",c);ChangeTitleToMDTooltip(c,b)});$("tbody i:contains('lens')").each(function(a){if($(this).attr("title")===undefined){return true}var c="i_lens_"+a;var b=$(this).attr("title");$(this).removeAttr("title");$(this).attr("id",c);ChangeTitleToMDTooltip(c,b)});$("select").each(function(a){if($(this).attr("title")===undefined){return true}var c=$(this).attr("id");var b=$(this).attr("title");$(this).removeAttr("title");ChangeTitleToMDTooltip(c,b)});$("span.hidden-text").each(function(a){if($(this).attr("title")===undefined){return true}var c="span_hidden-text_"+a;var b=$(this).attr("title");$(this).removeAttr("title");$(this).attr("id",c);ChangeTitleToMDTooltip(c,b)})}function ResetTableParametres(){$(".card-square").show();$("table.full-size > tbody > tr").show();$("#workgroupSelect, #workStateSelect, #roomSelect, #genderSelect").val("");$("#workstateMenu").attr("datavalue","");$("#stateMenuSpan").text("Статус");$("#groupMenuSpan").text("Группа");$("#roomMenuSpan").text("Комната");$("#card-man, #card-woman").removeClass("checked");$("#card-allpeople").addClass("checked");$("#searchInput").val("").parent().removeClass("is-dirty");$("#card-searchInput").val("").parent().removeClass("is-dirty");$("th.workstate i").css("color","white").css("textShadow","-1px 0 gray, 0 1px gray, 1px 0 gray, 0 -1px gray")}function AddToggleButtonTableAndCards(){var b=$('<i id="table-icon" class="material-icons">list</i>');var a=$('<i id="card-icon" class="material-icons">apps</i>');var f=$("<button></button>",{id:"table-button","class":"mdl-button mdl-js-button mdl-button--icon mdl-button--accent mdl-button--fab mdl-js-ripple-effect"}).append(b);var d=$("<button></button>",{id:"card-button","class":"mdl-button mdl-js-button mdl-button--icon mdl-button--accent mdl-js-ripple-effect"}).append(a);var g=$('<div id="toggle-div" class="toggle"></div>').append(f,d);$("main > span.mdl-layout-title").css({display:"flex",alignItems:"center",flexWrap:"wrap",minHeight:"65px"}).append(g);var e=$('<div id="toggle-tooltip" class="mdl-tooltip" for="table-button">Отображать <br>таблицей</div>');var c=$('<div id="toggle-tooltip" class="mdl-tooltip" for="card-button">Отображать <br>карточками</div>');componentHandler.upgradeElement(f.get(0));componentHandler.upgradeElement(d.get(0));componentHandler.upgradeElement(e.get(0));componentHandler.upgradeElement(c.get(0));g.append(e,c);if($("select#SummaryWithoutToday").length>0){ChangeTableCardMode()}}function ChangeTableCardMode(){if($("select#SummaryWithoutToday option:selected").val()=="No"){$("#table-button").click();$(".mdl-tooltip.is-active").removeClass("is-active")}else{$("#card-button").click();$(".mdl-tooltip.is-active").removeClass("is-active")}}function SetWorkerCards(){var c=$("<div></div>",{"class":"card-box"});var b;var a=$("table.full-size tbody tr").each(function(d){b=getMDLCard($(this),d);c.append(b)});$("table.full-size").after(c);c.hide();$("div.card-box div.mdl-tooltip").each(function(){var f=$(this).attr("for");var e=$(this).text();var d=!$(this).parent().hasClass("mdl-card__supporting-text");$(this).remove();ChangeTitleToMDTooltip(f,e,(d?"mdl-tooltip--left":""))})}function getMDLCard(b,h){var m=n(b,h);var c=e(b,h);var p=r(b,h);var o=s(b,h);var g=q(b,h);var i=k(b,h);var j=f(b,h);var d=$("<div></div>",{"class":"mdl-card__supporting-text"}).append(c).append(m).append(p).append(o).append(g).append(i).append(j);var l=$('<div class="mdl-card__menu"></div>');if($(m).find("span.hidden-text").length>0){$(m).find("span.hidden-text").each(function(){var u="card-"+$(this).attr("id");var t=$(m).find("div.mdl-tooltip[for="+$(this).attr("id")+"]").first();$(this).attr("id",u);t.attr("for",u);t.removeAttr("data-upgraded")})}var a=$("<div></div>",{"class":"card-square mdl-card mdl-shadow--2dp"}).css({order:h}).append(d,l);return a;function e(A,y){var w=A.children("td.indicator.workstate").children("i").first().css("color").replace("rgb","rgba");w=w.substr(0,w.length-1);w+=",1)";var B=$('<div id="person-image'+y+'" class="circular" ></div>').css({border:"4px solid "+w,background:w});var v=A.children("td.indicator.workstate").find("img").attr("src");B.attr("datavalue",v);var z=$("<div></div>",{"class":"employee"}).css({alignSelf:"flex-start"}).append(A.children("td.text.employee").html());var t=A.children("td.text.workgroup").text();var u=$("<div></div>",{"class":"rowDiv titleDivSmall"}).append(z).append(t?'<span class="workgroup">'+t+"</span>":"");var x=$("<div></div>",{"class":"rowDiv"}).append(B,u);return x}function n(x,u){var y=x.children("td.text.info").first().html();var w=$('<span class="info"></span>').append(y);var v=$('<i class="material-icons">info_outline</i>');var t=$("<div></div>",{"class":"rowDiv"}).append(v,w);return y.trim()?t:""}function r(x,u){var t=x.children("td.text.phone.first").text();var w=$('<span class="phone first"></span>').append(t);var v=$('<i class="material-icons">phonelink</i>');var y=$("<div></div>",{"class":"rowDiv"}).append(v,w);return t?y:""}function s(w,u){var t=w.children("td.text.phone.second").text();var y=$('<span class="phone second"></span>').append(t);var x=$('<i class="material-icons">smartphone</i>');var v=$("<div></div>",{"class":"rowDiv"}).append(x,y);return t?v:""}function q(v,t){var u=v.children("td.text.phone.third").text();var y=$('<span class="phone third"></span>').append(u);var x=$('<i class="material-icons">phone</i>');var w=$("<div></div>",{"class":"rowDiv"}).append(x,y);return u?w:""}function k(w,v){var y=w.children("td.text.room").text();var u=$('<span class="room"></span>').append(y);var t=$('<i class="material-icons">room</i>');var x=$("<div></div>",{"class":"rowDiv"}).append(t,u);return y?x:""}function f(z,v){var u=z.find("td.indicator.mail a img").attr("title");var x=$('<span class="email"></span>').append(u);var w=$('<i class="material-icons">email</i>');var t=$("<div></div>",{"class":"rowDiv"}).append(w,x);var y=$("<a></a>",{href:z.find("td.indicator.mail a").attr("href")}).append(t);return u?y:""}}function AddFilterMenuForCards(){var h=$("<div></div>",{"class":"card-sorting-menu toggle"});$("#toggle-div").after(h);e(h);g(h);d(h);f(h);b(h);a(h);c(h);h.hide();function e(l){var i=$("<input>",{type:"text","class":"mdl-textfield__input",id:"card-searchInput"});var m=$("<label></label>",{"class":"mdl-textfield__label","for":"card-searchInput",style:"line-height: 12pt !important;"}).append("Сотрудник");var k=$('<i class="material-icons" style="float: left; margin-top: 22px;">search</i>');var n=$("<div></div>",{"class":"mdl-textfield mdl-js-textfield"}).append(i,m);var j=$("<div class='toggle'></div>").append(k,n);l.append(j);componentHandler.upgradeElement(n.get(0));ChangeTitleToMDTooltip("card-searchInput","Введите фамилию <br>или имя сотрудника")}function g(l){var m,j;var k,i;if(IsMyHomeOffice()){m=$('<button style="float: left;" id="card-groupSelectButton" class="mdl-button mdl-js-button mdl-button--icon  mdl-button--accent mdl-js-ripple-effect"><i class="material-icons">group</i></button>');j=$('<div class="mdl-tooltip" for="card-groupSelectButton">Моя группа</div>');k=$('<button style="float: left;" id="card-roomSelectButton" class="mdl-button mdl-js-button mdl-button--icon  mdl-button--accent mdl-js-ripple-effect"><i class="material-icons">weekend</i></button>');i=$('<div class="mdl-tooltip" for="card-roomSelectButton">Моя комната</div>')}if(m!==undefined&&j!==undefined&&$("div.card-square span.workgroup").length>0){l.append(m,j);componentHandler.upgradeElement(m.get(0));componentHandler.upgradeElement(j.get(0))}if(k!==undefined&&i!==undefined&&$("div.card-square span.room").length>0){l.append(k,i);componentHandler.upgradeElement(k.get(0));componentHandler.upgradeElement(i.get(0))}}function d(u){var j="workstateMenu";var r=$('<i class="material-icons">lens</i>');var s=$('<span id="stateMenuSpan">Статус</span>');var m=$("<button></button>",{id:j,"class":"mdl-button mdl-js-button",datavalue:""}).append(r).append(s);var t=["Статус","На работе","Работает удаленно","Закончил работу","Отсутствует"];var q=["","/Content/ball_green.png","/Content/ball_blue.png","/Content/ball_yellow.png","/Content/ball_gray.png"];var v,n,l;var k=$("<ul></ul>",{"class":"mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect","for":j});for(var p=0;p<q.length;p++){n=$('<i class="material-icons">lens</i>');l=$('<span class="stateTextSpan">'+t[p]+"</span>");v=$("<li></li>",{"class":"mdl-menu__item selectLi",datavalue:q[p]}).append(n).append(l);k.append(v)}var o=$('<div class="card-stateSelect"></div>').append(m,k);u.append(o);componentHandler.upgradeElement(m.get(0));componentHandler.upgradeElement(k.get(0));componentHandler.upgradeElement(o.get(0))}function f(r){var j="groupMenu";var o=$('<span id="groupMenuSpan">Группа</span>');var k=$("<button></button>",{id:j,"class":"mdl-button mdl-js-button"}).append(o);var s=GetGroupNames();var q=["Группа"].concat(s);var p=[""].concat(s);var u=$("<ul></ul>",{"class":"mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect","for":j});var m=false;var t;for(var l=0;l<p.length;l++){t=$("<li></li>",{"class":"mdl-menu__item selectLi",datavalue:p[l]}).append(q[l]);if(p[l]){m=true}u.append(t)}var n=$('<div class="card-groupSelect"></div>').append(k,u);if(m){r.append(n);componentHandler.upgradeElement(k.get(0));componentHandler.upgradeElement(u.get(0));componentHandler.upgradeElement(n.get(0))}}function b(t){var q="roomMenu";var n=$('<span id="roomMenuSpan">Комната</span>');var r=$("<button></button>",{id:q,"class":"mdl-button mdl-js-button"}).append(n);var m=GetRoomNumbers();var p=["Комната"].concat(m);var k=[""].concat(m);var s=$("<ul></ul>",{"class":"mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect","for":q});var l=false;for(var o=0;o<k.length;o++){li=$("<li></li>",{"class":"mdl-menu__item selectLi",datavalue:k[o]}).append(p[o]);if(k[o]){l=true}s.append(li)}var j=$('<div class="card-roomSelect"></div>').append(r,s);if(l){t.append(j);componentHandler.upgradeElement(r.get(0));componentHandler.upgradeElement(s.get(0));componentHandler.upgradeElement(j.get(0))}}function a(t){var s=$('<i class="material-icons">wc</i>');var p=$("<button></button>",{id:"card-allpeople","class":"checked mdl-button mdl-js-button mdl-button--icon mdl-button--accent mdl-js-ripple-effect",type:"button"}).append(s);var l=$('<div class="mdl-tooltip" for="card-allpeople">Все сотрудники</div>');var i=$('<span id="badgeAll" class="genderMenu mdl-badge mdl-badge--no-background mdl-badge--overlap" data-badge="0"></span>').append(p,l);var j="♂";var u=$("<button></button>",{id:"card-man","class":"mdl-button mdl-js-button mdl-button--icon mdl-button--accent mdl-js-ripple-effect",type:"button"}).append(j);var q=$('<div class="mdl-tooltip" for="card-man">Мужчины</div>');var o=$('<span id="badgeMan" class="genderMenu mdl-badge mdl-badge--no-background mdl-badge--overlap"  data-badge="0"></span>').append(u,q);var k="♀";var n=$("<button></button>",{id:"card-woman","class":"mdl-button mdl-js-button mdl-button--icon mdl-button--accent mdl-js-ripple-effect",type:"button"}).append(k);var m=$('<div class="mdl-tooltip" for="card-woman">Женщины</div>');var r=$('<span id="badgeWoman" class="genderMenu mdl-badge mdl-badge--no-background mdl-badge--overlap" data-badge="0"></span>').append(n,m);t.append(i,o,r);componentHandler.upgradeElement(p.get(0));componentHandler.upgradeElement(l.get(0));componentHandler.upgradeElement(u.get(0));componentHandler.upgradeElement(q.get(0));componentHandler.upgradeElement(n.get(0));componentHandler.upgradeElement(m.get(0))}function c(l){var k=$('<i class="material-icons">clear</i>');var j=$("<button></button>",{id:"card-idReset","class":"mdl-button mdl-js-button  mdl-button--fab mdl-button--icon mdl-button--accent  mdl-js-ripple-effect",type:"button"}).append(k);var i=$('<div class="mdl-tooltip" for="card-idReset">Сбросить<br>фильтры</div>');l.append(j,i);componentHandler.upgradeElement(j.get(0));componentHandler.upgradeElement(i.get(0));j.hide()}}function CreateEmailButton(c){var d=$('<i class="material-icons">email</i>');var f=$("<button></button>",{id:"card-email","class":"mdl-button mdl-js-button mdl-button--icon mdl-button--accent mdl-js-ripple-effect",type:"button"}).append(d);var b="mailto:";$("div.card-square").each(function(){var g=$(this);b+=g.find("span.email").text()+";"});var e=$("<a></a>",{href:b}).css({marginLeft:"8px"}).append(f);var a=$('<div class="mdl-tooltip" for="card-email">Отправить письмо <br>выбранным людям</div>');c.append(e,a);componentHandler.upgradeElement(f.get(0));componentHandler.upgradeElement(a.get(0))}function FilterPeople(e){var b="td.employee";var d=b+':contains("'+e+'")';$(d).parent().show();$(b).not(d).parent().hide();$("th.workstate i").css("color","white").css("textShadow","-1px 0 gray, 0 1px gray, 1px 0 gray, 0 -1px gray");var a="div.card-square > div.mdl-card__supporting-text > div.rowDiv > div.rowDiv.titleDivSmall > div.employee";var c=a+':contains("'+e+'")';$(c).parent().parent().parent().parent().show();$(a).not(c).parent().parent().parent().parent().hide()}function SetProfileImages(){ClearLocalStorage();$("div.card-square").each(function(){var a=$(this);var d=a.children("div.mdl-card__supporting-text").first().children("div.rowDiv").first().children("div.circular").first();var b=a.find("span.email").first().text();var e,c;if(b){if(localStorage[b]){e=localStorage[b];if(e){SetIndividualProfileImage(d,e)}}else{$.get("http://confirmitconnect.firmglobal.com/Search/Pages/PeopleResults.aspx?k="+b,{},function(h,f,j){var i=FixDownloadedDataForProfileImages(h);var g=$("<div></div>");g.html(i);e=g.find("#CSR_IMG_1").attr("src");if(e){localStorage[b]=e;SetIndividualProfileImage(d,e)}})}}})}function ClearLocalStorage(){}function SetAllPeopleGender(){ClearLocalStorage();$("div.card-square").each(function(d){var a=$(this);var c=a.find(".employee").first().text();var b=a.find("span.email").first().text();var e;if(c){if(localStorage[c]){e=localStorage[c];if(e){SetGender(a,e)}}else{$.get("http://morpher.ru/Demo.aspx?s="+c,{},function(h,f,j){var i=FixDownloadedDataForGender(h);var g=$("<div></div>");g.html(i);e=g.find("#ctl00_ctl00_BodyPlaceHolder_ContentPlaceHolder1_РодЧислоLabel").text();if(e){localStorage[c]=e;SetGender(a,e)}})}}})}function SetRussianEquivalentForEnglishNames(a){ClearLocalStorage();$("div.card-square").each(function(f){var c=$(this);var e=c.find(".employee").first().text();var d=c.find("span.email").first().text();var g=d.indexOf("@");var b=d.substr(0,g);if(b){localStorage[b]=e;localStorage[a]=true}})}function SetGenderForEnglishLanguage(){ClearLocalStorage();$("div.card-square").each(function(e){var b=$(this);var d=b.find("span.email").first().text();var g=d.indexOf("@");var a=d.substr(0,g);var c,f;if(a){if(localStorage[a]){c=localStorage[a];f=localStorage[c];if(f){SetGender(b,f)}}}})}function SetIndividualProfileImage(a,b){a.css({background:'url("'+b+'") no-repeat',backgroundSize:"cover"})}function SetGender(a,g){var c=+$("#badgeAll").attr("data-badge");$("#badgeAll").attr("data-badge",+c+1);var b=a.find(".circular").first();var d=b.parent();if(g.toLowerCase().indexOf("мужской")>=0){var e=$('<span class="man mdl-badge mdl-badge--overlap" data-badge="♂"></span>').append(b);d.prepend(e);e.parent().css("paddingTop","8px");var i=+$("#badgeMan").attr("data-badge");$("#badgeMan").attr("data-badge",+i+1)}if(g.toLowerCase().indexOf("женский")>=0){var h=$('<span class="woman mdl-badge mdl-badge--overlap" data-badge="♀"></span>').append(b);d.prepend(h);h.parent().css("paddingTop","8px");var f=+$("#badgeWoman").attr("data-badge");$("#badgeWoman").attr("data-badge",+f+1)}}function FixDownloadedDataForProfileImages(a){return a.replace(/\/(_layouts|Style)+/g,"http://confirmitconnect.firmglobal.com/$1").replace("IMNRC","String.prototype.toLowerCase")}function FixDownloadedDataForGender(a){return a.replace(/(\/WebResource|images|orphus|logo)+/g,"http://morpher.ru/$1").replace("IMNRC","String.prototype.toLowerCase")}function SetEmailButtonLink(){$("button#card-email").parent().attr("href",CreateEmailLink())}function CreateEmailLink(){var a="mailto:";if($("table.full-size:visible").length>0){$("table.full-size tbody tr:visible").each(function(){var b=$(this);a+=b.find("td.indicator.mail a").attr("href").replace("mailto:","")+";"})}else{$("div.card-square:visible").each(function(){var b=$(this);a+=b.find("span.email").text()+";"})}return a}$(document).ready(function(){CreateSearchInput_withMD();SetClassesOnColumns();CreateSelectForGroups();CreateSelectOnWorkState();CreateSelectOnRoom();CreateSelectOnGender();PrepareEmployeeColumnForSort();PrepareWorkgroupColumnForSort();PrepareRoomColumnForSort();RemoveEmptyColumns();AddResetFiltersButton();CreateSettingsForLangAndDisplay();CreateMDLCard();AddBorderToStatusSelect();AddTooltips_officeScript();$("button").not("#idReset").not(".mdl-button--icon").not("form[action='/Remote/Come'] button, form[action='/Remote/Leave'] button").each(function(a){ChangeButtonsToMD.apply(this)});$("table.full-size").before($("div.holiday-box"));ShowTableFullSizeAndHolidayBox();ResizeTableHeader();SetTableHeightForOffice();CreateEmailButton($("main span.mdl-layout-title"));AddToggleButtonTableAndCards();SetWorkerCards();AddFilterMenuForCards();SetProfileImages();SetAllPeopleGender();SetEmailButtonLink();$("#searchInput").on("input",function(){$("#workgroupSelect, #workStateSelect, #roomSelect, #genderSelect").val("");$("#workstateMenu").attr("datavalue","");$("#stateMenuSpan").text("Статус");$("#groupMenuSpan").text("Группа");$("#roomMenuSpan").text("Комната");$("#card-man, #card-woman").removeClass("checked");$("#card-allpeople").addClass("checked");var a=escapeHtml($(this).val());$("#card-searchInput").val(a);FilterPeople(a);if(a!=""){$(this).parent().addClass("is-dirty");$("#card-searchInput").parent().addClass("is-dirty")}else{$(this).parent().removeClass("is-dirty");$("#card-searchInput").parent().removeClass("is-dirty")}ResizeTableHeader();SetTableHeightForOffice();CheckResetButton();SetEmailButtonLink()});$("#card-searchInput").on("input",function(){$("#workgroupSelect, #workStateSelect, #roomSelect, #genderSelect").val("");$("#workstateMenu").attr("datavalue","");$("#stateMenuSpan").text("Статус");$("#groupMenuSpan").text("Группа");$("#roomMenuSpan").text("Комната");var a=escapeHtml($(this).val());$("#searchInput").val(a);$("#card-man, #card-woman").removeClass("checked");$("#card-allpeople").addClass("checked");FilterPeople(a);if(a!=""){$(this).parent().addClass("is-dirty");$("#searchInput").parent().addClass("is-dirty")}else{$(this).parent().removeClass("is-dirty");$("#searchInput").parent().removeClass("is-dirty")}CheckResetButton();SetEmailButtonLink()});$("#workgroupSelect, #workStateSelect, #roomSelect, #genderSelect").change(function(){var c=$("select#workgroupSelect option").filter(":selected").text();$("#groupMenuSpan").text(c);var d=$("select#workStateSelect option").filter(":selected");var b=d.val();var a=d.text();a=a?a:"Статус";$("#workstateMenu").attr("datavalue",b);$("#stateMenuSpan").text(a);var f=$("select#roomSelect option").filter(":selected").text();$("#roomMenuSpan").text(f);var e=$("select#genderSelect option").filter(":selected").val();e=e?e:"allpeople";$("#card-allpeople, #card-man, #card-woman").removeClass("checked");$("#card-"+e).addClass("checked");SetFilters();ResizeTableHeader();SetTableHeightForOffice();CheckResetButton();SetEmailButtonLink()});$(".card-stateSelect li.selectLi").click(function(){var a=$(this).attr("datavalue");$("#workstateMenu").attr("datavalue",a);$("#stateMenuSpan").text($(this).find(".stateTextSpan").text());$("select#workStateSelect").val(a);SetFilters();ResizeTableHeader();SetTableHeightForOffice();CheckResetButton();SetEmailButtonLink()});$(".card-groupSelect li.selectLi").click(function(){var a=$(this).attr("datavalue");$("#groupMenuSpan").text($(this).text());$("select#workgroupSelect").val(a);SetFilters();ResizeTableHeader();SetTableHeightForOffice();CheckResetButton();SetEmailButtonLink()});$(".card-roomSelect li.selectLi").click(function(){var a=$(this).attr("datavalue");$("#roomMenuSpan").text($(this).text());$("select#roomSelect").val(a);SetFilters();ResizeTableHeader();SetTableHeightForOffice();CheckResetButton();SetEmailButtonLink()});$("#card-allpeople, #card-man, #card-woman").click(function(){$("#card-allpeople, #card-man, #card-woman").removeClass("checked");$(this).addClass("checked");var a=$(this).attr("id").replace("card-","").replace("allpeople","");$("select#genderSelect").val(a);SetFilters();ResizeTableHeader();SetTableHeightForOffice();CheckResetButton();SetEmailButtonLink()});$(".arrowDiv").click(function(){var c=GetColumnToSort($(this).parent());var b=$("table.full-size > tbody > tr");var a=$(".card-square");if($(this).hasClass("headerSortUp")){b=mergeSort(b,function(e,d){if($(e).children("td."+c).text().toLowerCase()>$(d).children("td."+c).text().toLowerCase()){return -1}else{if($(e).children("td."+c).text().toLowerCase()<$(d).children("td."+c).text().toLowerCase()){return 1}else{return 0}}});a=mergeSort(a,function(e,d){if($(e).find("."+c).text().toLowerCase()>$(d).find("."+c).text().toLowerCase()){return -1}else{if($(e).find("."+c).text().toLowerCase()<$(d).find("."+c).text().toLowerCase()){return 1}else{return 0}}});$(this).removeClass("headerSortUp").addClass("headerSortDown").css("backgroundImage","url("+chrome.extension.getURL("/images/asc.gif")+")")}else{b=mergeSort(b,function(e,d){if($(e).children("td."+c).text()>$(d).children("td."+c).text()){return 1}else{if($(e).children("td."+c).text()<$(d).children("td."+c).text()){return -1}else{return 0}}});a=mergeSort(a,function(e,d){if($(e).find("."+c).text().toLowerCase()>$(d).find("."+c).text().toLowerCase()){return 1}else{if($(e).find("."+c).text().toLowerCase()<$(d).find("."+c).text().toLowerCase()){return -1}else{return 0}}});$(this).removeClass("headerSortDown").addClass("headerSortUp").css("backgroundImage","url("+chrome.extension.getURL("/images/desc.gif")+")")}$("table.full-size > tbody").append(b);$(a).each(function(d){$(this).css({order:d})});$("div.card-box").append(a)});$("button#idReset").on("click",function(){ResetTableParametres();ResizeTableHeader();SetTableHeightForOffice();SetEmailButtonLink();$(this).fadeOut("fast");$("button#card-idReset").fadeOut("fast")});$("button#card-idReset").on("click",function(){ResetTableParametres();SetEmailButtonLink();$(this).fadeOut("fast");$("button#idReset").fadeOut("fast")});$("#roomSelectButton").click(function(){ResetTableParametres();SelectHomeRoom();ResizeTableHeader();SetTableHeightForOffice();CheckResetButton();SetEmailButtonLink()});$("#groupSelectButton").click(function(){ResetTableParametres();SelectHomeGroup();ResizeTableHeader();SetTableHeightForOffice();CheckResetButton();SetEmailButtonLink()});$("#card-roomSelectButton").click(function(){ResetTableParametres();SelectHomeRoom();CheckResetButton();SetEmailButtonLink()});$("#card-groupSelectButton").click(function(){ResetTableParametres();SelectHomeGroup();CheckResetButton();SetEmailButtonLink()});$("#table-button").click(function(){var a="mdl-button--fab";if($(this).hasClass(a)){return}$(this).addClass(a);$("#card-button").removeClass(a);$("table.full-size").show();$("div.card-box").hide();$("div.card-sorting-menu").hide();ResizeTableHeader();SetTableHeightForOffice()});$("#card-button").click(function(){var a="mdl-button--fab";if($(this).hasClass(a)){return}$(this).addClass(a);$("#table-button").removeClass(a);$("div.card-box").show();$("div.card-sorting-menu").show();$("table.full-size").hide()});$(window).resize(function(){ResizeTableHeader();SetTableHeightForOffice()}).resize()});